<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bundle HTML to PDF - Test UI</title>
    <link rel="stylesheet" href="../css/health-status.css" />
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f8f9fa;
        line-height: 1.6;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background-color: white;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        margin: 0 0 10px 0;
        font-size: 2.5rem;
        font-weight: 700;
      }

      .header p {
        margin: 0;
        opacity: 0.9;
        font-size: 1.1rem;
      }

      .back-button {
        display: inline-block;
        padding: 12px 24px;
        background-color: rgba(255, 255, 255, 0.2);
        color: white;
        text-decoration: none;
        border-radius: 8px;
        margin-top: 20px;
        transition: background-color 0.3s;
        border: 1px solid rgba(255, 255, 255, 0.3);
      }

      .back-button:hover {
        background-color: rgba(255, 255, 255, 0.3);
      }

      .content {
        padding: 30px;
      }

      .section {
        margin-bottom: 40px;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        overflow: hidden;
      }

      .section-header {
        background-color: #f8f9fa;
        padding: 20px;
        border-bottom: 1px solid #e9ecef;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .section-title {
        margin: 0;
        font-size: 1.4rem;
        color: #495057;
        font-weight: 600;
      }

      .section-content {
        padding: 20px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #495057;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid #ced4da;
        border-radius: 6px;
        font-size: 14px;
        transition: border-color 0.3s;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      /* Ensure color input matches text input height */
      .form-group input[type="color"] {
        height: 40px;
        padding: 6px;
        cursor: pointer;
      }

      .form-group textarea {
        min-height: 120px;
        resize: vertical;
        font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
      }

      .checkbox-group {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
      }

      .checkbox-group input[type="checkbox"] {
        width: auto;
        margin: 0;
      }

      /* Toggle Button Group Styles */
      .toggle-button-group {
        display: flex;
        border: 1px solid #ced4da;
        border-radius: 6px;
        gap: 1px;
        height: 40px; /* Same height as text inputs (12px padding + 14px font + 12px padding + 2px border) */
      }

      .toggle-btn {
        flex: 1;
        padding: 12px 16px;
        border: none;
        background: #f8f9fa;
        color: #6c757d;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 5px;
      }

      .toggle-btn:hover {
        background: #e9ecef;
        color: #495057;
      }

      .toggle-btn.active {
        background: #007bff;
        color: white;
      }

      .toggle-btn.active:hover {
        background: #0056b3;
      }

      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        text-decoration: none;
        display: inline-block;
        text-align: center;
      }

      .btn-primary {
        background-color: #667eea;
        color: white;
      }

      .btn-primary:hover {
        background-color: #5a6fd8;
        transform: translateY(-1px);
      }

      .btn-success {
        background-color: #28a745;
        color: white;
      }

      .btn-success:hover {
        background-color: #218838;
      }

      .btn-danger {
        background-color: #dc3545;
        color: white;
      }

      .btn-danger:hover {
        background-color: #c82333;
      }

      .btn-secondary {
        background-color: #6c757d;
        color: white;
      }

      .btn-secondary:hover {
        background-color: #5a6268;
      }

      .btn-sm {
        padding: 8px 16px;
        font-size: 12px;
      }

      .page-item {
        border: 1px solid #e9ecef;
        border-radius: 8px;
        margin-bottom: 20px;
        overflow: hidden;
        transition: all 0.3s;
      }

      .page-item.editing {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .page-header {
        background-color: #f8f9fa;
        padding: 15px 20px;
        border-bottom: 1px solid #e9ecef;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .page-title {
        margin: 0;
        font-size: 1.1rem;
        color: #495057;
        font-weight: 600;
      }

      .page-actions {
        display: flex;
        gap: 10px;
      }

      .page-content {
        padding: 20px;
      }

      .page-content.disabled {
        opacity: 0.6;
        pointer-events: none;
      }

      .json-output {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 6px;
        padding: 20px;
        margin-top: 20px;
      }

      .json-output pre {
        margin: 0;
        white-space: pre-wrap;
        word-wrap: break-word;
        font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
        font-size: 12px;
        line-height: 1.4;
      }

      .response-output {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 6px;
        padding: 20px;
        margin-top: 20px;
      }

      .response-output h3 {
        margin: 0 0 15px 0;
        color: #495057;
        font-size: 16px;
      }

      .response-output pre {
        margin: 0;
        white-space: pre-wrap;
        word-wrap: break-word;
        font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
        font-size: 14px;
        line-height: 1.4;
        color: #333;
        background-color: #fff;
        padding: 15px;
        border-radius: 4px;
        border: 1px solid #dee2e6;
      }

      /* Loading spinner styles */
      .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #007bff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 10px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }

      .loading-content {
        background: white;
        padding: 30px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        max-width: 300px;
      }

      .loading-content h3 {
        margin: 0 0 15px 0;
        color: #333;
      }

      .loading-content p {
        margin: 0;
        color: #666;
        font-size: 14px;
      }

      .hidden {
        display: none;
      }

      /* Toast Notification Styles */
      .toast {
        position: fixed;
        top: 20px;
        right: 20px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        padding: 16px 20px;
        min-width: 300px;
        max-width: 400px;
        z-index: 10000;
        transform: translateX(100%);
        transition: transform 0.3s ease-in-out;
        border-left: 4px solid #28a745;
      }

      .toast.show {
        transform: translateX(0);
      }

      .toast.error {
        border-left-color: #dc3545;
      }

      .toast.warning {
        border-left-color: #ffc107;
      }

      .toast.info {
        border-left-color: #17a2b8;
      }

      .toast-header {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
      }

      .toast-icon {
        font-size: 20px;
        margin-right: 10px;
      }

      .toast-title {
        font-weight: 600;
        font-size: 14px;
        color: #333;
        margin: 0;
      }

      .toast-close {
        margin-left: auto;
        background: none;
        border: none;
        font-size: 18px;
        color: #999;
        cursor: pointer;
        padding: 0;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .toast-close:hover {
        color: #666;
      }

      .toast-message {
        font-size: 13px;
        color: #666;
        line-height: 1.4;
        margin: 0;
      }

      .toast-progress {
        position: absolute;
        bottom: 0;
        left: 0;
        height: 3px;
        background: #28a745;
        border-radius: 0 0 8px 8px;
        animation: toastProgress 5s linear forwards;
      }

      .toast.error .toast-progress {
        background: #dc3545;
      }

      .toast.warning .toast-progress {
        background: #ffc107;
      }

      .toast.info .toast-progress {
        background: #17a2b8;
      }

      @keyframes toastProgress {
        from {
          width: 100%;
        }
        to {
          width: 0%;
        }
      }

      /* Mobile responsive */
      @media (max-width: 768px) {
        .toast {
          top: 10px;
          right: 10px;
          left: 10px;
          min-width: auto;
          max-width: none;
        }
      }

      /* Confirmation Modal Styles */
      .confirmation-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10001;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .confirmation-modal.show {
        opacity: 1;
        visibility: visible;
      }

      .confirmation-content {
        background: white;
        border-radius: 12px;
        padding: 24px;
        max-width: 400px;
        width: 90%;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        transform: scale(0.8);
        transition: transform 0.3s ease;
      }

      .confirmation-modal.show .confirmation-content {
        transform: scale(1);
      }

      .confirmation-icon {
        font-size: 48px;
        margin-bottom: 16px;
      }

      .confirmation-title {
        font-size: 20px;
        font-weight: 600;
        color: #333;
        margin-bottom: 12px;
      }

      .confirmation-message {
        font-size: 14px;
        color: #666;
        margin-bottom: 24px;
        line-height: 1.5;
      }

      .confirmation-buttons {
        display: flex;
        gap: 12px;
        justify-content: center;
      }

      .confirmation-btn {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        min-width: 80px;
      }

      .confirmation-btn-cancel {
        background: #f8f9fa;
        color: #6c757d;
        border: 1px solid #dee2e6;
      }

      .confirmation-btn-cancel:hover {
        background: #e9ecef;
        color: #495057;
      }

      .confirmation-btn-confirm {
        background: #dc3545;
        color: white;
      }

      .confirmation-btn-confirm:hover {
        background: #c82333;
      }

      /* Mobile responsive for confirmation modal */
      @media (max-width: 768px) {
        .confirmation-content {
          margin: 20px;
          padding: 20px;
        }

        .confirmation-buttons {
          flex-direction: column;
        }

        .confirmation-btn {
          width: 100%;
        }
      }

      .grid-2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }

      .grid-3 {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 20px;
      }

      .grid-4 {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr 1fr;
        gap: 20px;
      }

      /* SafeFrame Settings Custom Grid */
      .safeframe-settings-grid {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr;
        gap: 20px;
      }

      .safeframe-toggle-group {
        /* 50% width - takes 2fr out of 4fr total */
      }

      .safeframe-stroke-group,
      .safeframe-color-group {
        /* 25% width each - takes 1fr out of 4fr total */
      }

      .template-buttons {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .template-btn {
        padding: 15px 20px;
        font-size: 14px;
        font-weight: 600;
        border-radius: 8px;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        min-height: 50px;
      }

      .template-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      }

      .template-btn:active {
        transform: translateY(0);
      }

      @media (max-width: 768px) {
        .grid-2,
        .grid-3,
        .grid-4,
        .safeframe-settings-grid {
          grid-template-columns: 1fr;
        }

        .page-header {
          flex-direction: column;
          gap: 15px;
          align-items: flex-start;
        }

        .page-actions {
          width: 100%;
          justify-content: flex-end;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Bundle HTML to PDF - Test UI</h1>
        <p>
          Create and manage PDF document bundles with custom pages, styles, and
          scripts
        </p>
        <a href="../pages/api-docs.html#bundle-html2pdf" class="back-button"
          >← Back to Documentation</a
        >
      </div>

      <div class="content">
        <!-- Sample Templates -->
        <div class="section">
          <div class="section-header">
            <h2 class="section-title">Sample Templates</h2>
            <p style="margin: 0; color: #666; font-size: 14px">
              Click any template to load pre-configured data
            </p>
          </div>
          <div class="section-content">
            <div class="template-buttons">
              <button
                class="btn btn-primary template-btn"
                onclick="loadTemplate('test-anonymous')"
              >
                📄 Anonymous Test Data
              </button>
              <button
                class="btn btn-primary template-btn"
                onclick="loadTemplate('event-ticket')"
              >
                🎫 Event Ticket
              </button>
              <button
                class="btn btn-primary template-btn"
                onclick="loadTemplate('car-finance')"
              >
                🚗 Car Finance Policy
              </button>
              <button
                class="btn btn-primary template-btn"
                onclick="loadTemplate('tenancy-agreement')"
              >
                🏠 Tenancy Agreement
              </button>
              <button
                class="btn btn-primary template-btn"
                onclick="loadTemplate('airline-itinerary')"
              >
                ✈️ Airline Itinerary
              </button>
              <button
                class="btn btn-primary template-btn"
                onclick="loadTemplate('medical-report')"
              >
                🏥 Medical Lab Report
              </button>
              <button
                class="btn btn-primary template-btn"
                onclick="loadTemplate('hotel-invoice')"
              >
                🏨 Hotel Invoice
              </button>
              <button
                class="btn btn-primary template-btn"
                onclick="loadTemplate('university-transcript')"
              >
                🎓 University Transcript
              </button>
              <button
                class="btn btn-primary template-btn"
                onclick="loadTemplate('software-license')"
              >
                💻 Software License
              </button>
              <button
                class="btn btn-primary template-btn"
                onclick="loadTemplate('gym-membership')"
              >
                💪 Gym Membership
              </button>
              <button
                class="btn btn-primary template-btn"
                onclick="loadTemplate('donation-receipt')"
              >
                💝 Donation Receipt
              </button>
              <button
                class="btn btn-primary template-btn"
                onclick="loadTemplate('house-mortgage')"
              >
                🏡 House Mortgage
              </button>
            </div>
          </div>
        </div>

        <!-- Global Configuration -->
        <div class="section">
          <div class="section-header">
            <h2 class="section-title">Global Configuration</h2>
          </div>
          <div class="section-content">
            <div class="grid-2">
              <div class="form-group">
                <label for="documentTitle">Document Title</label>
                <input type="text" id="documentTitle" value="A PDF Document" />
              </div>
              <div class="form-group">
                <label for="pageSize">Page Size</label>
                <select id="pageSize">
                  <option value="A4">A4</option>
                  <option value="A3">A3</option>
                  <option value="Letter">Letter</option>
                  <option value="Legal">Legal</option>
                </select>
              </div>
            </div>

            <div class="grid-4">
              <div class="form-group">
                <label for="marginTop">Margin Top (mm)</label>
                <input type="text" id="marginTop" value="0" />
              </div>
              <div class="form-group">
                <label for="marginRight">Margin Right (mm)</label>
                <input type="text" id="marginRight" value="0" />
              </div>
              <div class="form-group">
                <label for="marginBottom">Margin Bottom (mm)</label>
                <input type="text" id="marginBottom" value="0" />
              </div>
              <div class="form-group">
                <label for="marginLeft">Margin Left (mm)</label>
                <input type="text" id="marginLeft" value="0" />
              </div>
            </div>

            <div class="grid-2">
              <div class="form-group">
                <label for="headerHeight">Header Height (mm)</label>
                <input type="text" id="headerHeight" value="15" />
              </div>
              <div class="form-group">
                <label for="footerHeight">Footer Height (mm)</label>
                <input type="text" id="footerHeight" value="10" />
              </div>
            </div>

            <!-- SafeFrame Options -->
            <h3
              style="
                margin: 30px 0 15px 0;
                color: #333;
                border-bottom: 2px solid #e9ecef;
                padding-bottom: 8px;
              "
            >
              SafeFrame Options
            </h3>

            <!-- SafeFrame Settings Row -->
            <div class="safeframe-settings-grid">
              <div class="form-group safeframe-toggle-group">
                <label>Enable SafeFrame</label>
                <div class="toggle-button-group">
                  <button
                    type="button"
                    class="toggle-btn active"
                    data-value="true"
                    onclick="toggleSafeFrame(true)"
                  >
                    On
                  </button>
                  <button
                    type="button"
                    class="toggle-btn"
                    data-value="false"
                    onclick="toggleSafeFrame(false)"
                  >
                    Off
                  </button>
                </div>
              </div>
              <div class="form-group safeframe-stroke-group">
                <label for="safeFrameStroke">Stroke Width (px)</label>
                <input type="text" id="safeFrameStroke" value="0" />
              </div>
              <div class="form-group safeframe-color-group">
                <label for="safeFrameColor">Stroke Color</label>
                <input type="color" id="safeFrameColor" value="#000000" />
              </div>
            </div>

            <!-- SafeFrame Offsets Row -->
            <div class="grid-4" style="margin-top: 15px">
              <div class="form-group">
                <label for="safeFrameTopOffset">Top Offset (px)</label>
                <input type="text" id="safeFrameTopOffset" value="0" />
              </div>
              <div class="form-group">
                <label for="safeFrameBottomOffset">Bottom Offset (px)</label>
                <input type="text" id="safeFrameBottomOffset" value="0" />
              </div>
              <div class="form-group">
                <label for="safeFrameLeftOffset">Left Offset (px)</label>
                <input type="text" id="safeFrameLeftOffset" value="0" />
              </div>
              <div class="form-group">
                <label for="safeFrameRightOffset">Right Offset (px)</label>
                <input type="text" id="safeFrameRightOffset" value="0" />
              </div>
            </div>

            <!-- Pagination Options -->
            <h3
              style="
                margin: 30px 0 15px 0;
                color: #333;
                border-bottom: 2px solid #e9ecef;
                padding-bottom: 8px;
              "
            >
              Pagination Options
            </h3>
            <div class="checkbox-group">
              <input type="checkbox" id="useBuiltInPaginator" checked />
              <label for="useBuiltInPaginator">Use Built-in Paginator</label>
            </div>

            <!-- Security Options -->
            <h3
              style="
                margin: 30px 0 15px 0;
                color: #333;
                border-bottom: 2px solid #e9ecef;
                padding-bottom: 8px;
              "
            >
              Security Options
            </h3>
            <div class="grid-2">
              <div class="checkbox-group">
                <input type="checkbox" id="sanitizeHtml" checked />
                <label for="sanitizeHtml">Sanitize HTML</label>
              </div>
              <div class="checkbox-group">
                <input type="checkbox" id="allowExternalResources" checked />
                <label for="allowExternalResources"
                  >Allow External Resources</label
                >
              </div>
            </div>

            <div class="form-group">
              <div
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 8px;
                "
              >
                <label for="globalCSS">Default CSS</label>
                <div>
                  <button
                    class="btn btn-sm btn-primary"
                    onclick="toggleGlobalEdit('globalCSS')"
                    id="globalCSS-btn"
                  >
                    Edit
                  </button>
                </div>
              </div>
              <textarea
                id="globalCSS"
                placeholder="Enter global CSS styles here..."
                onchange="updateGlobalField('globalCSS', this.value)"
              ></textarea>
            </div>

            <div class="form-group">
              <div
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 8px;
                "
              >
                <label for="globalJS">Default JavaScript</label>
                <div>
                  <button
                    class="btn btn-sm btn-primary"
                    onclick="toggleGlobalEdit('globalJS')"
                    id="globalJS-btn"
                  >
                    Edit
                  </button>
                </div>
              </div>
              <textarea
                id="globalJS"
                placeholder="Enter global JavaScript code here..."
                onchange="updateGlobalField('globalJS', this.value)"
              ></textarea>
            </div>

            <div class="form-group">
              <div
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 8px;
                "
              >
                <label for="globalHeader">Default Header</label>
                <div>
                  <button
                    class="btn btn-sm btn-primary"
                    onclick="toggleGlobalEdit('globalHeader')"
                    id="globalHeader-btn"
                  >
                    Edit
                  </button>
                </div>
              </div>
              <textarea
                id="globalHeader"
                placeholder="Enter global header HTML here..."
                onchange="updateGlobalField('globalHeader', this.value)"
              ></textarea>
            </div>

            <div class="form-group">
              <div
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 8px;
                "
              >
                <label for="globalFooter">Default Footer</label>
                <div>
                  <button
                    class="btn btn-sm btn-primary"
                    onclick="toggleGlobalEdit('globalFooter')"
                    id="globalFooter-btn"
                  >
                    Edit
                  </button>
                </div>
              </div>
              <textarea
                id="globalFooter"
                placeholder="Enter global footer HTML here..."
                onchange="updateGlobalField('globalFooter', this.value)"
              ></textarea>
            </div>
          </div>
        </div>

        <!-- Pages Management -->
        <div class="section">
          <div class="section-header">
            <h2 class="section-title">Pages Management</h2>
            <div style="display: flex; gap: 10px">
              <button class="btn btn-success" onclick="saveAllPages()">
                💾 Save All Pages
              </button>
              <button class="btn btn-primary" onclick="addNewPage()">
                + Add New Page
              </button>
            </div>
          </div>
          <div class="section-content">
            <div id="pagesContainer">
              <!-- Pages will be dynamically added here -->
            </div>
          </div>
        </div>

        <!-- JSON Output -->
        <div class="section">
          <div class="section-header">
            <h2 class="section-title">Generated JSON</h2>
            <div>
              <button class="btn btn-secondary" onclick="generateJSON()">
                Generate JSON
              </button>
              <button
                class="btn btn-primary"
                onclick="generatePDF()"
                id="generatePDFBtn"
              >
                Generate PDF
              </button>
            </div>
          </div>
          <div class="section-content">
            <div class="json-output">
              <pre id="jsonOutput">
Click "Generate JSON" to see the output...</pre
              >
            </div>
            <div
              class="response-output"
              id="responseOutput"
              style="display: none; margin-top: 20px"
            >
              <h3>API Response</h3>
              <pre id="responseText"></pre>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      let pageCounter = 0;
      let pages = [];

      // Global field states
      let globalFields = {
        globalCSS: { isEditing: false, isSaved: false, originalValue: "" },
        globalJS: { isEditing: false, isSaved: false, originalValue: "" },
        globalHeader: { isEditing: false, isSaved: false, originalValue: "" },
        globalFooter: { isEditing: false, isSaved: false, originalValue: "" },
      };

      // Template configuration mapping
      const templateConfig = {
        "test-anonymous": "../test-data/test-anonymous.json",
        "event-ticket": "../test-data/Templates/01_event_ticket.json",
        "car-finance": "../test-data/Templates/02_car_finance_policy.json",
        "tenancy-agreement":
          "../test-data/Templates/03_home_tenancy_agreement.json",
        "airline-itinerary": "../test-data/Templates/04_airline_itinerary.json",
        "medical-report": "../test-data/Templates/05_medical_lab_report.json",
        "hotel-invoice": "../test-data/Templates/06_hotel_invoice.json",
        "university-transcript":
          "../test-data/Templates/07_university_transcript.json",
        "software-license":
          "../test-data/Templates/08_software_license_certificate.json",
        "gym-membership":
          "../test-data/Templates/09_gym_membership_contract.json",
        "donation-receipt": "../test-data/Templates/10_donation_receipt.json",
        "house-mortgage": "../test-data/Templates/11_house_mortgage.json",
      };

      const templateDisplayNames = {
        "test-anonymous": "Anonymous Test Data",
        "event-ticket": "Event Ticket",
        "car-finance": "Car Finance Policy",
        "tenancy-agreement": "Tenancy Agreement",
        "airline-itinerary": "Airline Itinerary",
        "medical-report": "Medical Lab Report",
        "hotel-invoice": "Hotel Invoice",
        "university-transcript": "University Transcript",
        "software-license": "Software License",
        "gym-membership": "Gym Membership",
        "donation-receipt": "Donation Receipt",
        "house-mortgage": "House Mortgage",
      };

      // Load template function
      async function loadTemplate(templateName) {
        try {
          console.log(`Loading template: ${templateName}`);

          // Show loading state
          const buttons = document.querySelectorAll(".template-btn");
          buttons.forEach((btn) => {
            btn.disabled = true;
            btn.style.opacity = "0.6";
          });

          const templatePath = templateConfig[templateName];
          if (!templatePath) {
            throw new Error(`Template '${templateName}' not found`);
          }

          console.log(`Fetching template from: ${templatePath}`);
          const response = await fetch(templatePath);
          if (!response.ok) {
            throw new Error(
              `Failed to load template: ${response.status} - ${response.statusText}`
            );
          }

          const data = await response.json();
          console.log("Template data loaded:", data);

          const bundle = data.pdfDocumentBundle;
          if (!bundle) {
            throw new Error(
              "Invalid template format: missing pdfDocumentBundle"
            );
          }

          // Load the template data
          await loadTemplateData(bundle);

          console.log(`Template '${templateName}' loaded successfully`);

          // Show success toast
          const displayName =
            templateDisplayNames[templateName] || templateName;
          showToast(
            "success",
            "Template Loaded Successfully!",
            `"${displayName}" template has been loaded and applied to the form.`,
            6000
          );
        } catch (error) {
          console.error(`Error loading template '${templateName}':`, error);
          // Don't show error toast for initial load, just log the error
          if (templateName !== "test-anonymous") {
            const displayName =
              templateDisplayNames[templateName] || templateName;
            showToast(
              "error",
              "Template Load Failed",
              `Failed to load "${displayName}" template: ${error.message}`,
              8000
            );
          }
        } finally {
          // Reset button states
          const buttons = document.querySelectorAll(".template-btn");
          buttons.forEach((btn) => {
            btn.disabled = false;
            btn.style.opacity = "1";
          });
        }
      }

      // Load template data into the UI
      async function loadTemplateData(bundle) {
        // Extract global CSS from the bundle
        const globalCSS =
          bundle.head.styles && bundle.head.styles.length > 0
            ? bundle.head.styles[0].content
                .replace(/<style>\s*/, "")
                .replace(/\s*<\/style>/, "")
            : "";

        // Extract global header from the bundle
        const globalHeader = bundle.header || "";

        // Extract global footer from the bundle
        const globalFooter = bundle.footer || "";

        // Extract global JS from the bundle
        const globalJS =
          bundle.scripts && bundle.scripts.length > 0
            ? bundle.scripts[0].content
                .replace(/<script>\s*/, "")
                .replace(/\s*<\/script>/, "")
            : "";

        // Set initial values (raw content, like Page Body HTML)
        document.getElementById("globalCSS").value = globalCSS;
        document.getElementById("globalHeader").value = globalHeader;
        document.getElementById("globalFooter").value = globalFooter;
        document.getElementById("globalJS").value = globalJS;

        // Initialize global fields in editing mode (like Page Body HTML)
        globalFields.globalCSS = {
          isEditing: true,
          isSaved: false,
          originalValue: globalCSS,
        };
        globalFields.globalHeader = {
          isEditing: true,
          isSaved: false,
          originalValue: globalHeader,
        };
        globalFields.globalFooter = {
          isEditing: true,
          isSaved: false,
          originalValue: globalFooter,
        };
        globalFields.globalJS = {
          isEditing: true,
          isSaved: false,
          originalValue: globalJS,
        };

        // Set initial button states to "Save" since fields start in editing mode
        document.getElementById("globalCSS-btn").textContent = "Save";
        document.getElementById("globalCSS-btn").className =
          "btn btn-sm btn-success";
        document.getElementById("globalHeader-btn").textContent = "Save";
        document.getElementById("globalHeader-btn").className =
          "btn btn-sm btn-success";
        document.getElementById("globalFooter-btn").textContent = "Save";
        document.getElementById("globalFooter-btn").className =
          "btn btn-sm btn-success";
        document.getElementById("globalJS-btn").textContent = "Save";
        document.getElementById("globalJS-btn").className =
          "btn btn-sm btn-success";

        // Set document title from the bundle
        document.getElementById("documentTitle").value =
          bundle.head.title || "Test Document";

        // Clear the JSON output
        document.getElementById("jsonOutput").textContent =
          "Click 'Generate JSON' to see the output...";

        // Hide the response output if it's visible
        const responseOutput = document.getElementById("responseOutput");
        if (responseOutput) {
          responseOutput.style.display = "none";
        }

        // Add all pages from the bundle
        console.log("Adding pages from bundle...");
        addAllPolicyPagesFromBundle(bundle);
        console.log("Pages added:", pages.length);
      }

      // Add all pages from bundle function
      function addAllPolicyPagesFromBundle(bundle) {
        // Clear existing pages from the array
        pages = [];
        pageCounter = 0;

        // Clear existing page elements from the DOM
        const pagesContainer = document.getElementById("pagesContainer");
        if (pagesContainer) {
          pagesContainer.innerHTML = "";
        }

        // Add all pages from the bundle
        if (bundle.body && bundle.body.pages) {
          bundle.body.pages.forEach((pageData, index) => {
            const title = pageData.section?.dataTitle || `Page ${index + 1}`;
            const body = pageData.body || "";
            const header = pageData.header || "";
            const footer = pageData.footer || "";
            const styles = pageData.styles || [];
            const scripts = pageData.scripts || [];

            addPolicyPageFromBundle(
              title,
              body,
              header,
              footer,
              styles,
              scripts
            );
          });
        }
      }

      // Add policy page from bundle function
      function addPolicyPageFromBundle(
        title,
        body,
        header = null,
        footer = null,
        styles = [],
        scripts = []
      ) {
        pageCounter++;
        const pageId = `page-${pageCounter}`;
        const page = {
          id: pageId,
          title: title,
          pageNumber: pages.length + 1,
          sectionClass: "page",
          dataTitle: title,
          showHeader: true,
          showFooter: true,
          body: body,
          header: header || "",
          footer: footer || "",
          customCSS:
            styles.length > 0
              ? styles[0].content
                  .replace(/<style>\s*/, "")
                  .replace(/\s*<\/style>/, "")
              : "",
          customJS:
            scripts.length > 0
              ? scripts[0].content
                  .replace(/<script>\s*/, "")
                  .replace(/\s*<\/script>/, "")
              : "",
          hasCustomCSS: styles.length > 0,
          hasCustomJS: scripts.length > 0,
          hasCustomHeader: header ? true : false,
          hasCustomFooter: footer ? true : false,
          isEditing: true,
          isSaved: false,
        };

        pages.push(page);
        // Update pageNumber after adding to array
        page.pageNumber = pages.length;
        renderPage(page);
      }

      // Initialize with sample data
      function initializeSampleData() {
        const globalCSS = `html, body {
  margin: 0;
  padding: 0;
  background: #fff;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}

.document { 
  background: #fff; 
  padding: 40px;
}

.page {
  width: var(--page-width);
  height: var(--page-height);
  margin: -20px -20px -20px 0px;
  background: #fff;
  position: relative;
  overflow: hidden;
  page-break-after: always;
  background-color: white;
}

.page:last-child { 
  page-break-after: auto;
}`;

        const globalHeader = `<header>
  <div class="hdr" data-align="right">
    <div class="slot">
      <img alt="Logo" src="https://www.insuredaily.co.uk/web/assets/images/logo/InsureDaily_short_term_car_insurance_logo.webp">
    </div>
  </div>
</header>`;

        const globalFooter = `<footer>
  <div class="ftr" data-align="center">
    <div class="slot text">
      InsureDaily is a trading name of Ramasis Limited who is authorised and regulated by the Financial Conduct Authority - 306294
    </div>
  </div>
</footer>`;

        // Set initial values (raw content, like Page Body HTML)
        document.getElementById("globalCSS").value = globalCSS;
        document.getElementById("globalHeader").value = globalHeader;
        document.getElementById("globalFooter").value = globalFooter;

        // Initialize global fields in editing mode (like Page Body HTML)
        globalFields.globalCSS = {
          isEditing: true,
          isSaved: false,
          originalValue: globalCSS,
        };
        globalFields.globalHeader = {
          isEditing: true,
          isSaved: false,
          originalValue: globalHeader,
        };
        globalFields.globalFooter = {
          isEditing: true,
          isSaved: false,
          originalValue: globalFooter,
        };
        globalFields.globalJS = {
          isEditing: true,
          isSaved: false,
          originalValue: "",
        };

        // Set initial button states to "Save" since fields start in editing mode
        document.getElementById("globalCSS-btn").textContent = "Save";
        document.getElementById("globalCSS-btn").className =
          "btn btn-sm btn-success";
        document.getElementById("globalHeader-btn").textContent = "Save";
        document.getElementById("globalHeader-btn").className =
          "btn btn-sm btn-success";
        document.getElementById("globalFooter-btn").textContent = "Save";
        document.getElementById("globalFooter-btn").className =
          "btn btn-sm btn-success";
        document.getElementById("globalJS-btn").textContent = "Save";
        document.getElementById("globalJS-btn").className =
          "btn btn-sm btn-success";

        // Add a sample page
        addNewPage();
      }

      function addNewPage() {
        pageCounter++;
        const pageId = `page-${pageCounter}`;
        const page = {
          id: pageId,
          title: "A PDF page",
          pageNumber: pages.length + 1,
          sectionClass: "page",
          dataTitle: `Page ${pages.length + 1} Details`,
          showHeader: true,
          showFooter: true,
          body: '<main class="body"><div class="flow"><h1>Sample Page Content</h1><p>This is a sample page. Edit the content below.</p></div></main>',
          header: "",
          footer: "",
          customCSS: "",
          customJS: "",
          hasCustomCSS: false,
          hasCustomJS: false,
          hasCustomHeader: false,
          hasCustomFooter: false,
          isEditing: true,
          isSaved: false,
        };

        pages.push(page);
        // Update pageNumber after adding to array
        page.pageNumber = pages.length;
        renderPage(page);
      }

      function renderPage(page) {
        const container = document.getElementById("pagesContainer");
        const pageElement = document.createElement("div");
        pageElement.className = `page-item ${page.isEditing ? "editing" : ""}`;
        pageElement.id = `page-element-${page.id}`;

        pageElement.innerHTML = `
          <div class="page-header">
            <h3 class="page-title" id="page-title-${page.id}">Page ${
          page.pageNumber
        } (${page.title})</h3>
            <div class="page-actions">
              <button class="btn btn-sm btn-secondary" onclick="openPreviewModal('${
                page.id
              }')">👁️ Preview</button>
              <button class="btn btn-sm ${
                page.isEditing ? "btn-success" : "btn-primary"
              }" 
                      onclick="toggleEdit('${page.id}')">
                ${page.isEditing ? "Save" : "Edit"}
              </button>
              <button class="btn btn-sm btn-danger" onclick="deletePage('${
                page.id
              }')">Delete</button>
            </div>
          </div>
          <div class="page-content ${page.isEditing ? "" : "disabled"}">
            <div class="form-group">
              <label>Page Title</label>
              <input type="text" value="${
                page.title
              }" onchange="updatePageTitle('${page.id}', this.value)" ${
          page.isEditing ? "" : "disabled"
        } />
            </div>
            
            <div class="form-group">
              <label>CSS Class Name</label>
              <input type="text" value="${
                page.sectionClass
              }" placeholder="e.g., page, section, content" onchange="updatePageProperty('${
          page.id
        }', 'sectionClass', this.value)" ${page.isEditing ? "" : "disabled"} />
              <small style="color: #666; font-size: 12px;">Enter a CSS class name (without the dot). Default CSS includes styles for "page" class.</small>
            </div>
            
            <div class="form-group">
              <label>Page Description</label>
              <input type="text" value="${
                page.dataTitle
              }" onchange="updatePageProperty('${
          page.id
        }', 'dataTitle', this.value)" ${page.isEditing ? "" : "disabled"} />
            </div>
            
            <div class="checkbox-group">
              <input type="checkbox" id="showHeader-${page.id}" ${
          page.showHeader ? "checked" : ""
        } 
                     onchange="updatePageProperty('${
                       page.id
                     }', 'showHeader', this.checked)" ${
          page.isEditing ? "" : "disabled"
        } />
              <label for="showHeader-${page.id}">Display Header</label>
            </div>
            
            <div class="checkbox-group">
              <input type="checkbox" id="showFooter-${page.id}" ${
          page.showFooter ? "checked" : ""
        } 
                     onchange="updatePageProperty('${
                       page.id
                     }', 'showFooter', this.checked)" ${
          page.isEditing ? "" : "disabled"
        } />
              <label for="showFooter-${page.id}">Display Footer</label>
            </div>
            
            <div class="checkbox-group">
              <input type="checkbox" id="hasCustomCSS-${page.id}" ${
          page.hasCustomCSS ? "checked" : ""
        } 
                     onchange="toggleCustomCSS('${page.id}', this.checked)" ${
          page.isEditing ? "" : "disabled"
        } />
              <label for="hasCustomCSS-${page.id}">Custom CSS</label>
            </div>
            
            <div class="form-group ${
              page.hasCustomCSS ? "" : "hidden"
            }" id="customCSS-${page.id}">
              <label>Custom CSS</label>
              <textarea onchange="updatePageProperty('${
                page.id
              }', 'customCSS', this.value)" ${
          page.isEditing ? "" : "disabled"
        }>${page.customCSS}</textarea>
            </div>
            
            <div class="checkbox-group">
              <input type="checkbox" id="hasCustomJS-${page.id}" ${
          page.hasCustomJS ? "checked" : ""
        } 
                     onchange="toggleCustomJS('${page.id}', this.checked)" ${
          page.isEditing ? "" : "disabled"
        } />
              <label for="hasCustomJS-${page.id}">Custom JavaScript</label>
            </div>
            
            <div class="form-group ${
              page.hasCustomJS ? "" : "hidden"
            }" id="customJS-${page.id}">
              <label>Custom JavaScript</label>
              <textarea onchange="updatePageProperty('${
                page.id
              }', 'customJS', this.value)" ${
          page.isEditing ? "" : "disabled"
        }>${page.customJS}</textarea>
            </div>
            
            <div class="form-group">
              <label>Page Content</label>
              <textarea onchange="updatePageProperty('${
                page.id
              }', 'body', this.value)" ${page.isEditing ? "" : "disabled"}>${
          page.body
        }</textarea>
            </div>
            
            <div class="checkbox-group">
              <input type="checkbox" id="hasCustomHeader-${page.id}" ${
          page.hasCustomHeader ? "checked" : ""
        } 
                     onchange="toggleCustomHeader('${
                       page.id
                     }', this.checked)" ${page.isEditing ? "" : "disabled"} />
              <label for="hasCustomHeader-${page.id}">Custom Header</label>
            </div>
            
            <div class="form-group" id="customHeader-${
              page.id
            }" style="display: ${page.hasCustomHeader ? "block" : "none"}">
              <label>Header Content</label>
              <textarea onchange="updatePageProperty('${
                page.id
              }', 'header', this.value)" ${page.isEditing ? "" : "disabled"}>${
          page.header
        }</textarea>
            </div>
            
            <div class="checkbox-group">
              <input type="checkbox" id="hasCustomFooter-${page.id}" ${
          page.hasCustomFooter ? "checked" : ""
        } 
                     onchange="toggleCustomFooter('${
                       page.id
                     }', this.checked)" ${page.isEditing ? "" : "disabled"} />
              <label for="hasCustomFooter-${page.id}">Custom Footer</label>
            </div>
            
            <div class="form-group" id="customFooter-${
              page.id
            }" style="display: ${page.hasCustomFooter ? "block" : "none"}">
              <label>Footer Content</label>
              <textarea onchange="updatePageProperty('${
                page.id
              }', 'footer', this.value)" ${page.isEditing ? "" : "disabled"}>${
          page.footer
        }</textarea>
            </div>
          </div>
        `;

        container.appendChild(pageElement);
      }

      function toggleEdit(pageId) {
        const page = pages.find((p) => p.id === pageId);
        if (page) {
          if (page.isEditing) {
            // Save the page (no JSON escaping - only save the raw content)
            page.isEditing = false;
            page.isSaved = true;
          } else {
            // Edit the page
            page.isEditing = true;
            page.isSaved = false;
          }
          renderAllPages();
        }
      }

      function deletePage(pageId) {
        const page = pages.find((p) => p.id === pageId);
        const pageTitle = page ? page.title : "this page";

        showConfirmationModal(
          "Delete Page",
          `Are you sure you want to delete "${pageTitle}"? This action cannot be undone.`,
          () => {
            // User confirmed deletion
            pages = pages.filter((p) => p.id !== pageId);
            const pageElement = document.getElementById(
              `page-element-${pageId}`
            );
            if (pageElement) {
              pageElement.remove();
            }
            // Renumber all pages after deletion
            renumberPages();

            // Show success toast
            showToast(
              "success",
              "Page Deleted",
              `"${pageTitle}" has been successfully deleted.`
            );
          },
          () => {
            // User cancelled deletion
            showToast(
              "info",
              "Deletion Cancelled",
              "Page deletion was cancelled."
            );
          }
        );
      }

      function renumberPages() {
        pages.forEach((page, index) => {
          page.pageNumber = index + 1;
          // Update the page title display
          const titleElement = document.getElementById(`page-title-${page.id}`);
          if (titleElement) {
            titleElement.textContent = `Page ${page.pageNumber} (${page.title})`;
          }
        });
      }

      function updatePageTitle(pageId, title) {
        const page = pages.find((p) => p.id === pageId);
        if (page) {
          page.title = title;
          // Update the page title display
          const titleElement = document.getElementById(`page-title-${pageId}`);
          if (titleElement) {
            titleElement.textContent = `Page ${page.pageNumber} (${page.title})`;
          }
        }
      }

      function updatePageProperty(pageId, property, value) {
        const page = pages.find((p) => p.id === pageId);
        if (page) {
          page[property] = value;
        }
      }

      function toggleCustomCSS(pageId, enabled) {
        const page = pages.find((p) => p.id === pageId);
        if (page) {
          page.hasCustomCSS = enabled;
          const cssDiv = document.getElementById(`customCSS-${pageId}`);
          if (cssDiv) {
            cssDiv.classList.toggle("hidden", !enabled);
          }
        }
      }

      function toggleCustomJS(pageId, enabled) {
        const page = pages.find((p) => p.id === pageId);
        if (page) {
          page.hasCustomJS = enabled;
          const jsDiv = document.getElementById(`customJS-${pageId}`);
          if (jsDiv) {
            jsDiv.classList.toggle("hidden", !enabled);
          }
        }
      }

      function toggleCustomHeader(pageId, enabled) {
        const page = pages.find((p) => p.id === pageId);
        if (page) {
          page.hasCustomHeader = enabled;
          const headerDiv = document.getElementById(`customHeader-${pageId}`);
          if (headerDiv) {
            headerDiv.style.display = enabled ? "block" : "none";
          }
        }
      }

      function toggleCustomFooter(pageId, enabled) {
        const page = pages.find((p) => p.id === pageId);
        if (page) {
          page.hasCustomFooter = enabled;
          const footerDiv = document.getElementById(`customFooter-${pageId}`);
          if (footerDiv) {
            footerDiv.style.display = enabled ? "block" : "none";
          }
        }
      }

      function renderAllPages() {
        const container = document.getElementById("pagesContainer");
        container.innerHTML = "";
        pages.forEach((page) => renderPage(page));
      }

      // Function to escape JSON strings
      function escapeJsonString(str) {
        if (!str) return str;
        return str
          .replace(/\\/g, "\\\\") // Escape backslashes
          .replace(/"/g, '\\"') // Escape double quotes
          .replace(/\n/g, "\\n") // Escape newlines
          .replace(/\r/g, "\\r") // Escape carriage returns
          .replace(/\t/g, "\\t") // Escape tabs
          .replace(/\f/g, "\\f") // Escape form feeds
          .replace(/\b/g, "\\b"); // Escape backspaces
      }

      // Function to unescape JSON strings for editing
      function unescapeJsonString(str) {
        if (!str) return str;
        return str
          .replace(/\\b/g, "\b") // Unescape backspaces
          .replace(/\\f/g, "\f") // Unescape form feeds
          .replace(/\\t/g, "\t") // Unescape tabs
          .replace(/\\r/g, "\r") // Unescape carriage returns
          .replace(/\\n/g, "\n") // Unescape newlines
          .replace(/\\"/g, '"') // Unescape double quotes
          .replace(/\\\\/g, "\\"); // Unescape backslashes (must be last)
      }

      // Function to check if a string is already JSON escaped (for Pages Management)
      function isJsonEscaped(str) {
        if (!str) return true;

        // Check if the string contains unescaped characters that need JSON escaping
        // If it contains unescaped quotes, newlines, or backslashes, it's not escaped
        const hasUnescapedQuotes = /[^\\]"/.test(str) || str.startsWith('"');
        const hasUnescapedNewlines =
          /[^\\]\n/.test(str) || str.startsWith("\n");
        const hasUnescapedCarriageReturns =
          /[^\\]\r/.test(str) || str.startsWith("\r");
        const hasUnescapedBackslashes = /[^\\]\\[^"nrtrbf]/.test(str);

        // If any unescaped characters are found, the string is not JSON escaped
        return (
          !hasUnescapedQuotes &&
          !hasUnescapedNewlines &&
          !hasUnescapedCarriageReturns &&
          !hasUnescapedBackslashes
        );
      }

      // Function to check if a string is already JSON escaped (for Global fields only)
      function isGlobalFieldJsonEscaped(str) {
        if (!str) return true;

        // Check if the string contains unescaped characters that need JSON escaping
        const hasUnescapedQuotes = /[^\\]"/.test(str) || str.startsWith('"');
        const hasUnescapedNewlines =
          /[^\\]\n/.test(str) || str.startsWith("\n");
        const hasUnescapedCarriageReturns =
          /[^\\]\r/.test(str) || str.startsWith("\r");
        const hasUnescapedTabs = /[^\\]\t/.test(str) || str.startsWith("\t");
        const hasUnescapedFormFeeds =
          /[^\\]\f/.test(str) || str.startsWith("\f");
        const hasUnescapedBackspaces =
          /[^\\]\b/.test(str) || str.startsWith("\b");
        const hasUnescapedBackslashes = /[^\\]\\[^"nrtrbf]/.test(str);

        // If any unescaped characters are found, the string is not JSON escaped
        return (
          !hasUnescapedQuotes &&
          !hasUnescapedNewlines &&
          !hasUnescapedCarriageReturns &&
          !hasUnescapedTabs &&
          !hasUnescapedFormFeeds &&
          !hasUnescapedBackspaces &&
          !hasUnescapedBackslashes
        );
      }

      // Function to update JSON escape indicators (removed - no longer needed)
      function updateJsonEscapeIndicators() {
        // No longer needed since JSON escaping only happens during JSON generation
      }

      // Function to update global field value (like updatePageProperty)
      function updateGlobalField(fieldId, value) {
        if (globalFields[fieldId]) {
          globalFields[fieldId].originalValue = value;
        }
      }

      // Function to toggle global field edit mode (like toggleEdit for pages)
      function toggleGlobalEdit(fieldId) {
        const field = globalFields[fieldId];
        const textarea = document.getElementById(fieldId);
        const button = document.getElementById(fieldId + "-btn");

        if (field.isEditing) {
          // Save the field (no JSON escaping - only save the raw content)
          field.isEditing = false;
          field.isSaved = true;
          field.originalValue = textarea.value;
          textarea.disabled = true;
          button.textContent = "Edit";
          button.className = "btn btn-sm btn-primary";
        } else {
          // Edit the field
          field.isEditing = true;
          field.isSaved = false;
          textarea.disabled = false;
          button.textContent = "Save";
          button.className = "btn btn-sm btn-success";
        }
      }

      // Function to reset all fields to defaults
      function resetToDefaults() {
        if (
          confirm(
            "Are you sure you want to reset all fields to their default values? This will clear all your changes."
          )
        ) {
          // Reset global fields
          globalFields = {
            globalCSS: { isEditing: false, isSaved: false, originalValue: "" },
            globalJS: { isEditing: false, isSaved: false, originalValue: "" },
            globalHeader: {
              isEditing: false,
              isSaved: false,
              originalValue: "",
            },
            globalFooter: {
              isEditing: false,
              isSaved: false,
              originalValue: "",
            },
          };

          // Reset pages
          pages = [];
          pageCounter = 0;

          // Reset form values
          document.getElementById("documentTitle").value = "A PDF Document";
          document.getElementById("pageSize").value = "A4";
          document.getElementById("marginTop").value = "0";
          document.getElementById("marginRight").value = "0";
          document.getElementById("marginBottom").value = "0";
          document.getElementById("marginLeft").value = "0";
          document.getElementById("headerHeight").value = "15";
          document.getElementById("footerHeight").value = "10";

          // Reset global textareas
          document.getElementById("globalCSS").value = "";
          document.getElementById("globalJS").value = "";
          document.getElementById("globalHeader").value = "";
          document.getElementById("globalFooter").value = "";

          // Reset buttons
          ["globalCSS", "globalJS", "globalHeader", "globalFooter"].forEach(
            (fieldId) => {
              const button = document.getElementById(fieldId + "-btn");
              button.textContent = "Edit";
              button.className = "btn btn-sm btn-primary";
              document.getElementById(fieldId).disabled = true;
            }
          );

          // Reinitialize with sample data
          initializeSampleData();
        }
      }

      // Function to save all pages and escape their content
      function saveAllPages() {
        // Only save pages, not global fields

        // Then save all pages (no JSON escaping - only mark as saved)
        pages.forEach((page) => {
          // Mark as saved
          page.isSaved = true;
          page.isEditing = false;
        });
        renderAllPages();
      }

      function generateJSON() {
        // First save all pages with JSON escaping
        saveAllPages();

        const globalCSS = document.getElementById("globalCSS").value;
        const globalJS = document.getElementById("globalJS").value;
        const globalHeader = document.getElementById("globalHeader").value;
        const globalFooter = document.getElementById("globalFooter").value;
        const documentTitle = document.getElementById("documentTitle").value;
        const pageSize = document.getElementById("pageSize").value;
        const marginTop = document.getElementById("marginTop").value;
        const marginRight = document.getElementById("marginRight").value;
        const marginBottom = document.getElementById("marginBottom").value;
        const marginLeft = document.getElementById("marginLeft").value;
        const headerHeight = document.getElementById("headerHeight").value;
        const footerHeight = document.getElementById("footerHeight").value;

        // Get SafeFrame options
        const safeFrameEnabled = document
          .querySelector('.toggle-btn[data-value="true"]')
          .classList.contains("active");
        const safeFrameStroke =
          document.getElementById("safeFrameStroke").value;
        const safeFrameColor = document.getElementById("safeFrameColor").value;
        const safeFrameTopOffset =
          document.getElementById("safeFrameTopOffset").value;
        const safeFrameBottomOffset = document.getElementById(
          "safeFrameBottomOffset"
        ).value;
        const safeFrameLeftOffset = document.getElementById(
          "safeFrameLeftOffset"
        ).value;
        const safeFrameRightOffset = document.getElementById(
          "safeFrameRightOffset"
        ).value;

        // Get Pagination options
        const useBuiltInPaginator = document.getElementById(
          "useBuiltInPaginator"
        ).checked;

        // Get Security options
        const sanitizeHtml = document.getElementById("sanitizeHtml").checked;
        const allowExternalResources = document.getElementById(
          "allowExternalResources"
        ).checked;

        // Use global content directly (no JSON escaping needed for API)
        const escapedGlobalCSS = globalCSS;
        const escapedGlobalJS = globalJS;
        const escapedGlobalHeader = globalHeader;
        const escapedGlobalFooter = globalFooter;

        const jsonData = {
          pdfDocumentBundle: {
            head: {
              title: documentTitle,
              meta: [
                { charset: "utf-8" },
                {
                  name: "viewport",
                  content: "width=device-width,initial-scale=1",
                },
              ],
              styles: escapedGlobalCSS
                ? [
                    {
                      type: "inline",
                      content:
                        "<style>\r\n" + escapedGlobalCSS + "\r\n</style>",
                    },
                  ]
                : [],
            },
            layout: {
              page: {
                size: pageSize,
                margin: {
                  top: marginTop + "mm",
                  right: marginRight + "mm",
                  bottom: marginBottom + "mm",
                  left: marginLeft + "mm",
                },
                headerHeight: headerHeight + "mm",
                footerHeight: footerHeight + "mm",
              },
              safeFrame: {
                enabled: safeFrameEnabled,
                stroke: safeFrameStroke + "px",
                color: safeFrameColor,
                topOffset: safeFrameTopOffset + "px",
                bottomOffset: safeFrameBottomOffset + "px",
                leftOffset: safeFrameLeftOffset + "px",
                rightOffset: safeFrameRightOffset + "px",
              },
              useBuiltInPaginator: useBuiltInPaginator,
            },
            security: {
              sanitizeHtml: sanitizeHtml,
              allowExternalResources: allowExternalResources,
            },
            body: {
              document: { class: "document" },
              pages: pages.map((page) => {
                const pageData = {
                  section: {
                    class: page.sectionClass,
                    dataTitle: page.dataTitle,
                  },
                  options: {
                    showHeader: page.showHeader,
                    showFooter: page.showFooter,
                  },
                  body: page.body,
                };

                // Add page-specific header if available
                if (page.hasCustomHeader && page.header) {
                  pageData.header = page.header;
                }

                // Add page-specific footer if available
                if (page.hasCustomFooter && page.footer) {
                  pageData.footer = page.footer;
                }

                if (page.hasCustomCSS && page.customCSS) {
                  pageData.styles = [
                    {
                      type: "inline",
                      content: "<style>\r\n" + page.customCSS + "\r\n</style>",
                    },
                  ];
                }

                if (page.hasCustomJS && page.customJS) {
                  pageData.scripts = [
                    {
                      type: "inline",
                      content:
                        "<" +
                        "script>\r\n" +
                        page.customJS +
                        "\r\n</" +
                        "script>",
                    },
                  ];
                }

                return pageData;
              }),
            },
            header: escapedGlobalHeader,
            footer: escapedGlobalFooter,
            scripts: escapedGlobalJS
              ? [
                  {
                    type: "inline",
                    content:
                      "<" +
                      "script>\r\n" +
                      escapedGlobalJS +
                      "\r\n</" +
                      "script>",
                  },
                ]
              : [],
          },
          pdfOptions: {
            format: pageSize,
            printBackground: true,
            margin: {
              top: marginTop,
              right: marginRight,
              bottom: marginBottom,
              left: marginLeft,
            },
          },
        };

        document.getElementById("jsonOutput").textContent = JSON.stringify(
          jsonData,
          null,
          2
        );
      }

      async function generatePDF() {
        // Create loading overlay
        const loadingOverlay = document.createElement("div");
        loadingOverlay.className = "loading-overlay";
        loadingOverlay.innerHTML = `
          <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3>Generating PDF</h3>
            <p>Please wait while we create your PDF document...</p>
          </div>
        `;
        document.body.appendChild(loadingOverlay);

        try {
          // First generate the JSON
          generateJSON();

          // Get the JSON data
          const jsonData = JSON.parse(
            document.getElementById("jsonOutput").textContent
          );

          // Show response area
          const responseOutput = document.getElementById("responseOutput");
          responseOutput.style.display = "block";
          document.getElementById("responseText").textContent =
            "Sending request to API...";

          // Send request to the bundle HTML to PDF endpoint
          const response = await fetch("/api/v1/bundle/bundleHtml2PDF", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(jsonData),
          });

          // Display response
          const responseText = document.getElementById("responseText");

          if (response.ok) {
            // Get the PDF blob
            const pdfBlob = await response.blob();

            // Create download link
            const url = window.URL.createObjectURL(pdfBlob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `generated-pdf-${Date.now()}.pdf`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);

            responseText.textContent = `✅ PDF generated successfully!\nStatus: ${
              response.status
            }\nSize: ${(pdfBlob.size / 1024).toFixed(
              2
            )} KB\n\nPDF has been downloaded automatically.`;

            showToast(
              "success",
              "PDF Generated Successfully!",
              `Full document PDF has been downloaded (${(
                pdfBlob.size / 1024
              ).toFixed(2)} KB)`,
              7000
            );
          } else {
            // Handle error response
            const errorText = await response.text();
            responseText.textContent = `❌ Error generating PDF:\nStatus: ${response.status}\nResponse: ${errorText}`;

            showToast(
              "error",
              "PDF Generation Failed",
              `Status: ${response.status} - ${errorText}`,
              8000
            );
          }
        } catch (error) {
          console.error("Error:", error);
          document.getElementById(
            "responseText"
          ).textContent = `❌ Network Error: ${error.message}`;

          showToast("error", "Network Error", error.message, 8000);
        } finally {
          // Remove loading overlay
          document.body.removeChild(loadingOverlay);
        }
      }

      // Toggle SafeFrame function
      function toggleSafeFrame(enabled) {
        const onBtn = document.querySelector('.toggle-btn[data-value="true"]');
        const offBtn = document.querySelector(
          '.toggle-btn[data-value="false"]'
        );

        if (enabled) {
          onBtn.classList.add("active");
          offBtn.classList.remove("active");
          enableSafeFrameControls();
        } else {
          // Check if there are non-default values before disabling
          if (hasNonDefaultSafeFrameValues()) {
            showConfirmationModal(
              "Disable SafeFrame",
              "You have custom SafeFrame settings that will be reset to default values. Are you sure you want to disable SafeFrame?",
              () => {
                // User confirmed - proceed with disabling
                onBtn.classList.remove("active");
                offBtn.classList.add("active");
                disableSafeFrameControls();
                resetSafeFrameToDefaults();
                showToast(
                  "info",
                  "SafeFrame Disabled",
                  "SafeFrame has been disabled and all settings reset to defaults."
                );
              },
              () => {
                // User cancelled - keep SafeFrame enabled
                showToast(
                  "info",
                  "SafeFrame Kept Enabled",
                  "SafeFrame settings have been preserved."
                );
              }
            );
          } else {
            // No custom values, safe to disable
            onBtn.classList.remove("active");
            offBtn.classList.add("active");
            disableSafeFrameControls();
            resetSafeFrameToDefaults();
          }
        }
      }

      // Check if SafeFrame has non-default values
      function hasNonDefaultSafeFrameValues() {
        const strokeWidth = document.getElementById("safeFrameStroke").value;
        const strokeColor = document.getElementById("safeFrameColor").value;
        const topOffset = document.getElementById("safeFrameTopOffset").value;
        const bottomOffset = document.getElementById(
          "safeFrameBottomOffset"
        ).value;
        const leftOffset = document.getElementById("safeFrameLeftOffset").value;
        const rightOffset = document.getElementById(
          "safeFrameRightOffset"
        ).value;

        return (
          strokeWidth !== "0" ||
          strokeColor !== "#000000" ||
          topOffset !== "0" ||
          bottomOffset !== "0" ||
          leftOffset !== "0" ||
          rightOffset !== "0"
        );
      }

      // Enable SafeFrame controls
      function enableSafeFrameControls() {
        const controls = [
          "safeFrameStroke",
          "safeFrameColor",
          "safeFrameTopOffset",
          "safeFrameBottomOffset",
          "safeFrameLeftOffset",
          "safeFrameRightOffset",
        ];

        controls.forEach((id) => {
          const element = document.getElementById(id);
          element.disabled = false;
          element.style.opacity = "1";
          element.style.cursor = "auto";
        });
      }

      // Disable SafeFrame controls
      function disableSafeFrameControls() {
        const controls = [
          "safeFrameStroke",
          "safeFrameColor",
          "safeFrameTopOffset",
          "safeFrameBottomOffset",
          "safeFrameLeftOffset",
          "safeFrameRightOffset",
        ];

        controls.forEach((id) => {
          const element = document.getElementById(id);
          element.disabled = true;
          element.style.opacity = "0.6";
          element.style.cursor = "not-allowed";
        });
      }

      // Reset SafeFrame to default values
      function resetSafeFrameToDefaults() {
        document.getElementById("safeFrameStroke").value = "0";
        document.getElementById("safeFrameColor").value = "#000000";
        document.getElementById("safeFrameTopOffset").value = "0";
        document.getElementById("safeFrameBottomOffset").value = "0";
        document.getElementById("safeFrameLeftOffset").value = "0";
        document.getElementById("safeFrameRightOffset").value = "0";
      }

      // Confirmation modal functions
      function showConfirmationModal(
        title,
        message,
        onConfirm,
        onCancel = null
      ) {
        // Remove existing confirmation modals
        const existingModals = document.querySelectorAll(".confirmation-modal");
        existingModals.forEach((modal) => modal.remove());

        // Create modal element
        const modal = document.createElement("div");
        modal.className = "confirmation-modal";

        modal.innerHTML = `
          <div class="confirmation-content">
            <div class="confirmation-icon">⚠️</div>
            <h3 class="confirmation-title">${title}</h3>
            <p class="confirmation-message">${message}</p>
            <div class="confirmation-buttons">
              <button class="confirmation-btn confirmation-btn-cancel">Cancel</button>
              <button class="confirmation-btn confirmation-btn-confirm">Confirm</button>
            </div>
          </div>
        `;

        // Add to page
        document.body.appendChild(modal);

        // Show modal
        setTimeout(() => modal.classList.add("show"), 100);

        // Add event listeners
        const cancelBtn = modal.querySelector(".confirmation-btn-cancel");
        const confirmBtn = modal.querySelector(".confirmation-btn-confirm");

        const closeModal = () => {
          modal.classList.remove("show");
          setTimeout(() => modal.remove(), 300);
        };

        cancelBtn.addEventListener("click", () => {
          closeModal();
          if (onCancel) onCancel();
        });

        confirmBtn.addEventListener("click", () => {
          closeModal();
          if (onConfirm) onConfirm();
        });

        // Close on backdrop click
        modal.addEventListener("click", (e) => {
          if (e.target === modal) {
            closeModal();
            if (onCancel) onCancel();
          }
        });

        // Close on Escape key
        const handleEscape = (e) => {
          if (e.key === "Escape") {
            closeModal();
            if (onCancel) onCancel();
            document.removeEventListener("keydown", handleEscape);
          }
        };
        document.addEventListener("keydown", handleEscape);
      }

      // Toast notification functions
      function showToast(type, title, message, duration = 5000) {
        // Remove existing toasts
        const existingToasts = document.querySelectorAll(".toast");
        existingToasts.forEach((toast) => toast.remove());

        // Create toast element
        const toast = document.createElement("div");
        toast.className = `toast ${type}`;

        const icon =
          type === "success"
            ? "✅"
            : type === "error"
            ? "❌"
            : type === "warning"
            ? "⚠️"
            : "ℹ️";

        toast.innerHTML = `
          <div class="toast-header">
            <span class="toast-icon">${icon}</span>
            <h4 class="toast-title">${title}</h4>
            <button class="toast-close" onclick="this.parentElement.parentElement.remove()">&times;</button>
          </div>
          <p class="toast-message">${message}</p>
          <div class="toast-progress"></div>
        `;

        // Add to page
        document.body.appendChild(toast);

        // Show toast
        setTimeout(() => toast.classList.add("show"), 100);

        // Auto remove after duration
        setTimeout(() => {
          toast.classList.remove("show");
          setTimeout(() => toast.remove(), 300);
        }, duration);
      }

      // Preview button function - generates PDF for specific page
      async function openPreviewModal(pageId) {
        const page = pages.find((p) => p.id === pageId);
        if (!page) {
          showToast("error", "Error", "Page not found!");
          return;
        }

        // Create loading overlay
        const loadingOverlay = document.createElement("div");
        loadingOverlay.className = "loading-overlay";
        loadingOverlay.innerHTML = `
          <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3>Generating Page Preview PDF</h3>
            <p>Please wait while we create your single-page PDF...</p>
          </div>
        `;
        document.body.appendChild(loadingOverlay);

        try {
          // Get global configuration
          const globalCSS = document.getElementById("globalCSS").value;
          const globalJS = document.getElementById("globalJS").value;
          const globalHeader = document.getElementById("globalHeader").value;
          const globalFooter = document.getElementById("globalFooter").value;
          const documentTitle = document.getElementById("documentTitle").value;
          const pageSize = document.getElementById("pageSize").value;
          const marginTop = document.getElementById("marginTop").value;
          const marginRight = document.getElementById("marginRight").value;
          const marginBottom = document.getElementById("marginBottom").value;
          const marginLeft = document.getElementById("marginLeft").value;
          const headerHeight = document.getElementById("headerHeight").value;
          const footerHeight = document.getElementById("footerHeight").value;

          // Get SafeFrame options
          const safeFrameEnabled = document
            .querySelector('.toggle-btn[data-value="true"]')
            .classList.contains("active");
          const safeFrameStroke =
            document.getElementById("safeFrameStroke").value;
          const safeFrameColor =
            document.getElementById("safeFrameColor").value;
          const safeFrameTopOffset =
            document.getElementById("safeFrameTopOffset").value;
          const safeFrameBottomOffset = document.getElementById(
            "safeFrameBottomOffset"
          ).value;
          const safeFrameLeftOffset = document.getElementById(
            "safeFrameLeftOffset"
          ).value;
          const safeFrameRightOffset = document.getElementById(
            "safeFrameRightOffset"
          ).value;

          // Get Pagination options
          const useBuiltInPaginator = document.getElementById(
            "useBuiltInPaginator"
          ).checked;

          // Get Security options
          const sanitizeHtml = document.getElementById("sanitizeHtml").checked;
          const allowExternalResources = document.getElementById(
            "allowExternalResources"
          ).checked;

          // Create JSON data for single page
          const jsonData = {
            pdfDocumentBundle: {
              head: {
                title: documentTitle + " - " + page.title,
                meta: [
                  { charset: "utf-8" },
                  {
                    name: "viewport",
                    content: "width=device-width,initial-scale=1",
                  },
                ],
                styles: globalCSS
                  ? [
                      {
                        type: "inline",
                        content: "<style>\r\n" + globalCSS + "\r\n</style>",
                      },
                    ]
                  : [],
              },
              layout: {
                page: {
                  size: pageSize,
                  margin: {
                    top: marginTop + "mm",
                    right: marginRight + "mm",
                    bottom: marginBottom + "mm",
                    left: marginLeft + "mm",
                  },
                  headerHeight: headerHeight + "mm",
                  footerHeight: footerHeight + "mm",
                },
                safeFrame: {
                  enabled: safeFrameEnabled,
                  stroke: safeFrameStroke + "px",
                  color: safeFrameColor,
                  topOffset: safeFrameTopOffset + "px",
                  bottomOffset: safeFrameBottomOffset + "px",
                  leftOffset: safeFrameLeftOffset + "px",
                  rightOffset: safeFrameRightOffset + "px",
                },
                useBuiltInPaginator: useBuiltInPaginator,
              },
              security: {
                sanitizeHtml: sanitizeHtml,
                allowExternalResources: allowExternalResources,
              },
              body: {
                document: { class: "document" },
                pages: [
                  {
                    section: {
                      class: page.sectionClass,
                      dataTitle: page.dataTitle,
                    },
                    options: {
                      showHeader: page.showHeader,
                      showFooter: page.showFooter,
                    },
                    body: page.body,
                    // Add page-specific header if available
                    ...(page.hasCustomHeader &&
                      page.header && { header: page.header }),
                    // Add page-specific footer if available
                    ...(page.hasCustomFooter &&
                      page.footer && { footer: page.footer }),
                    // Add page-specific CSS if available
                    ...(page.hasCustomCSS &&
                      page.customCSS && {
                        styles: [
                          {
                            type: "inline",
                            content:
                              "<style>\r\n" + page.customCSS + "\r\n</style>",
                          },
                        ],
                      }),
                    // Add page-specific JS if available
                    ...(page.hasCustomJS &&
                      page.customJS && {
                        scripts: [
                          {
                            type: "inline",
                            content:
                              "<" +
                              "script>\r\n" +
                              page.customJS +
                              "\r\n</" +
                              "script>",
                          },
                        ],
                      }),
                  },
                ],
              },
              header: globalHeader,
              footer: globalFooter,
              scripts: globalJS
                ? [
                    {
                      type: "inline",
                      content:
                        "<" + "script>\r\n" + globalJS + "\r\n</" + "script>",
                    },
                  ]
                : [],
            },
            pdfOptions: {
              format: pageSize,
              printBackground: true,
              margin: {
                top: marginTop,
                right: marginRight,
                bottom: marginBottom,
                left: marginLeft,
              },
            },
          };

          // Send request to the bundle HTML to PDF endpoint
          const response = await fetch("/api/v1/bundle/bundleHtml2PDF", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(jsonData),
          });

          if (response.ok) {
            // Get the PDF blob
            const pdfBlob = await response.blob();

            // Create download link
            const url = window.URL.createObjectURL(pdfBlob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `page-preview-${page.title.replace(
              /[^a-zA-Z0-9]/g,
              "-"
            )}-${Date.now()}.pdf`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);

            showToast(
              "success",
              "PDF Generated Successfully!",
              `Page preview PDF has been downloaded: ${a.download}`,
              7000
            );
          } else {
            // Handle error response
            const errorText = await response.text();
            showToast(
              "error",
              "PDF Generation Failed",
              `Status: ${response.status} - ${errorText}`,
              8000
            );
          }
        } catch (error) {
          console.error("Error:", error);
          showToast("error", "Network Error", error.message, 8000);
        } finally {
          // Remove loading overlay
          document.body.removeChild(loadingOverlay);
        }
      }

      // Make functions globally accessible
      window.addNewPage = addNewPage;
      window.toggleEdit = toggleEdit;
      window.deletePage = deletePage;
      window.updatePageTitle = updatePageTitle;
      window.updatePageProperty = updatePageProperty;
      window.toggleCustomCSS = toggleCustomCSS;
      window.toggleCustomJS = toggleCustomJS;
      window.toggleCustomHeader = toggleCustomHeader;
      window.toggleCustomFooter = toggleCustomFooter;
      window.renderAllPages = renderAllPages;
      window.saveAllPages = saveAllPages;
      window.generateJSON = generateJSON;
      window.generatePDF = generatePDF;
      window.toggleGlobalEdit = toggleGlobalEdit;
      window.resetToDefaults = resetToDefaults;
      window.openPreviewModal = openPreviewModal;

      // Initialize the page
      document.addEventListener("DOMContentLoaded", function () {
        initializeSampleData();
        // Initialize SafeFrame controls state
        initializeSafeFrameControls();
      });

      // Initialize SafeFrame controls based on current state
      function initializeSafeFrameControls() {
        const isEnabled = document
          .querySelector('.toggle-btn[data-value="true"]')
          .classList.contains("active");
        if (isEnabled) {
          enableSafeFrameControls();
        } else {
          disableSafeFrameControls();
          resetSafeFrameToDefaults();
        }
      }
    </script>

    <!-- Health Status Widget -->
    <script src="../js/health-status.js"></script>
  </body>
</html>
